<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Spiral Admin Panel</title>
  <style>
    body { font-family: Arial, sans-serif; background:#222; color:#eee; padding: 20px;}
    table {width: 100%; border-collapse: collapse;}
    th, td {padding: 8px; border-bottom: 1px solid #444;}
    input, select, button {padding: 6px; margin: 4px;}
    .ban-btn {background:#e53935; color:#fff; border:none; cursor:pointer;}
    .unban-btn {background:#43a047; color:#fff; border:none; cursor:pointer;}
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>
  <h1>Spiral Admin Panel</h1>
  <table id="sessions-table">
    <thead>
      <tr><th>Session ID</th><th>Created</th><th>User Agent</th><th>Banned</th><th>Actions</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <h2>Ban/Unban Session</h2>
  <input id="session-id-input" placeholder="Session ID" />
  <input id="ban-reason-input" placeholder="Reason" />
  <select id="ban-type-select">
    <option value="temp">Temporary</option>
    <option value="perma">Permanent</option>
  </select>
  <input id="ban-code-input" placeholder="Ban Code (e.g. 204)" />
  <button id="ban-btn">Ban</button>
  <button id="unban-btn">Unban</button>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAFQKnND2YlRxv44QgdQkBHy8zWXRfvGZM",
      authDomain: "spiral-e7043.firebaseapp.com",
      databaseURL: "https://spiral-e7043-default-rtdb.firebaseio.com",
      projectId: "spiral-e7043",
      storageBucket: "spiral-e7043.appspot.com",
      messagingSenderId: "520773856265",
      appId: "1:520773856265:web:48a6bea4d1214d1f729cd8O6"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const sessionsTableBody = document.querySelector("#sessions-table tbody");
    const sessionIdInput = document.getElementById("session-id-input");
    const banReasonInput = document.getElementById("ban-reason-input");
    const banTypeSelect = document.getElementById("ban-type-select");
    const banCodeInput = document.getElementById("ban-code-input");
    const banBtn = document.getElementById("ban-btn");
    const unbanBtn = document.getElementById("unban-btn");

    function renderSessions(data) {
      sessionsTableBody.innerHTML = "";
      for (const [sessionId, info] of Object.entries(data)) {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${sessionId}</td>
          <td>${info.created || "N/A"}</td>
          <td>${info.userAgent || "N/A"}</td>
          <td>${info.banned ? "Yes" : "No"}</td>
          <td>
            <button class="ban-btn" data-id="${sessionId}">Ban</button>
            <button class="unban-btn" data-id="${sessionId}">Unban</button>
          </td>
        `;
        sessionsTableBody.appendChild(tr);
      }

      document.querySelectorAll(".ban-btn").forEach(btn => {
        btn.onclick = () => {
          const id = btn.dataset.id;
          banSession(id);
        };
      });
      document.querySelectorAll(".unban-btn").forEach(btn => {
        btn.onclick = () => {
          const id = btn.dataset.id;
          unbanSession(id);
        };
      });
    }

    function fetchSessions() {
      db.ref("sessions").once("value").then(snapshot => {
        const data = snapshot.val() || {};
        renderSessions(data);
      });
    }

    function banSession(id) {
      const reason = banReasonInput.value || "No reason given";
      const banType = banTypeSelect.value;
      const code = banCodeInput.value || 999;
      db.ref("bans/" + id).set({ reason, banType, code });
      db.ref("sessions/" + id + "/banned").set(true);
      alert(`Banned session ${id}`);
      fetchSessions();
    }

    function unbanSession(id) {
      db.ref("bans/" + id).remove();
      db.ref("sessions/" + id + "/banned").set(false);
      alert(`Unbanned session ${id}`);
      fetchSessions();
    }

    banBtn.onclick = () => {
      const id = sessionIdInput.value.trim();
      if (!id) return alert("Enter Session ID");
      banSession(id);
    };
    unbanBtn.onclick = () => {
      const id = sessionIdInput.value.trim();
      if (!id) return alert("Enter Session ID");
      unbanSession(id);
    };

    fetchSessions();
  </script>
</body>
</html>
